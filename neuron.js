var Network;Network=function(){var t,e,r,n,a,i,u,s,o,d,f,l,c,p,h,g,x,v,m,k,y,w;i=[];a=[];g={mouseDownNode:null,shiftDrag:false};t=0;p=null;e=null;s=null;o=null;h=null;r=function(t,e,r,n){return"M "+t+" "+e+" L "+r+" "+n};d=d3.behavior.drag().origin(function(t){return t}).on("drag",function(t){if(g.shiftDrag){return h.attr("d",r(t.x,t.y,d3.mouse(o.node())[0],d3.mouse(o.node())[1]))}else{t.x=d3.event.x;t.y=d3.event.y;d3.select(this).select("circle").attr("cx",t.x).attr("cy",t.y);d3.select(this).select("text").attr("x",t.x).attr("y",t.y);return k()}});u=function(t,n,a){var i;s=d3.select(t);o=s.append("svg").attr("width","100%").attr("height","100%");i=o.append("svg:defs");i.append("svg:marker").attr("id","drag-arrow").attr("viewBox","-5 -5 10 10").attr("refX","0").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");i.append("svg:marker").attr("id","edge-arrow").attr("viewBox","-5 -5 10 10").attr("refX","17").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");h=o.append("svg:path").style("marker-end","url(#drag-arrow)").attr("class","link").attr("d",r(0,0,0,0));h.classed("hidden",true);e=o.append("g").attr("id","edges");p=o.append("g").attr("id","nodes");o.on("dblclick",x);o.on("mousedown",v);o.on("mouseup",m);return k()};x=function(){var e,r;if(d3.event.defaultPrevented){return}e=d3.mouse(o.node());r={id:t++,x:e[0],y:e[1],inputs:[],outputs:[]};i.push(r);return k()};v=function(){};m=function(){if(g.shiftDrag){h.classed("hidden",true);return g.shiftDrag=false}};f=function(t){d3.event.stopPropagation();g.mouseDownNode=t;if(d3.event.shiftKey){g.shiftDrag=true;return h.classed("hidden",false).attr("d",r(t.x,t.y,t.x,t.y))}};l=function(t){var e,r,i;g.shiftDrag=false;i=g.mouseDownNode;if(!i){return}if(g.mouseDownNode!==t){e={start:i,finish:t};r=a.filter(function(t){if(t.start===e.finish&&t.finish===e.start){a.splice(a.indexOf(t))}return t.start===e.start&&t.finish===e.finish});if(r.length===0){i.outputs.push(e);t.inputs.push(e);a.push(e);if(n()){i.outputs.pop();t.inputs.pop();a.pop();alert("Neural Networks Can't Be Cyclic!")}k()}}return h.classed("hidden",true)};c=function(t){var e;d3.event.preventDefault();e=0;while(e<i.length){if(i[e].id===t.id){a=a.filter(function(t){var r;r=i[e];if(r.outputs.indexOf(t)<0&&r.inputs.indexOf(t)<0){return true}});i.splice(e,1);break}else{e+=1}}return k()};w=function(){var t,e;e=p.selectAll("g").data(i,function(t){return t.id});t=e.enter().append("g").on("contextmenu",c).on("mousedown",f).on("mouseup",l).call(d);t.append("circle");t.append("text");e.select("text").text(function(t){return t.id}).attr("x",function(t){return t.x+"px"}).attr("y",function(t){return t.y+"px"}).attr("fill","black");e.select("circle").attr("cx",function(t){return t.x+"px"}).attr("cy",function(t){return t.y+"px"}).attr("r","40").attr("class","node");e.attr("id",function(t){return t.id});return e.exit().remove()};y=function(){var t;t=e.selectAll("path").data(a,function(t){return t.start.id+"+"+t.finish.id});t.enter().append("path").style("marker-end","url(#edge-arrow)").classed("link",true);t.attr("d",function(t){return r(t.start.x,t.start.y,t.finish.x,t.finish.y)});return t.exit().remove()};k=function(){w();return y()};n=function(){var t,e,r,n,a,u,s,o,d;d=[];u=[];t=function(t){d[t]=false;return u[t]=false};for(r=n=0,s=i.length-1;0<=s?n<=s:n>=s;r=0<=s?++n:--n){t(r)}e=function(t){var r,n,a,s,o;if(d[t]===false){d[t]=true;u[t]=true;o=i[t].outputs;for(a=0,s=o.length;a<s;a++){r=o[a];n=i.indexOf(r.finish);if(!d[n]&&e(n)){return true}else if(u[n]){return true}}}u[t]=false;return false};for(r=a=0,o=i.length-1;0<=o?a<=o:a>=o;r=0<=o?++a:--a){if(e(r)){return true}}return false};return u};$(function(){var t;t=Network();return t("#neuron",[],[])});