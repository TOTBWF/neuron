var Edge,Network,Node;Node=function(){t.currentID=0;function t(e,n){this.x=e;this.y=n;this.id=t.currentID++;this.bias=0;this.inputWeights=[];this.inputs=[];this.outputs=[]}t.prototype.getAssociatedElement=function(){return d3.select("#node_"+this.id)};return t}();Edge=function(){function t(t,e){this.start=t;this.finish=e}return t}();Network=function(){var t,e,n,r,i,u,s,a,o,d,l,p,f,c,h,g,x,y,v,m,k,w,D,O,W,b,N,_,A,E,M,I,L,B,P,Y,C,H;s=[];u=[];v=[];w=[];b={};A={mouseDownNode:null,shiftDrag:false};W=null;O=null;n=null;o=null;x=null;g=null;d=null;l=null;p=null;c=null;f=null;h=null;N=null;r=function(t,e,n,r){return"M "+t+" "+e+" L "+n+" "+r};y=d3.behavior.drag().origin(function(t){return t}).on("drag",function(t){if(A.shiftDrag){return N.attr("d",r(t.x,t.y,d3.mouse(x.node())[0],d3.mouse(x.node())[1]))}else{t.x=d3.event.x;t.y=d3.event.y;d3.select(this).select("circle").attr("cx",t.x).attr("cy",t.y);d3.select(this).select("text").attr("x",t.x).attr("y",t.y);return P()}});a=function(t,e,i){var u;o=d3.select(t);d=d3.select("#neuron-panel-bias");g=d3.select("#neuron-panel-weights");p=d3.select("#input-switch-row").style("display","none");c=d3.select("#output-switch-row").style("display","none");f=d3.select("#input_toggle");h=d3.select("#output_toggle");f.on("change",L);h.on("change",B);x=o.append("svg").attr("class","neuron-svg");u=x.append("svg:defs");u.append("svg:marker").attr("id","drag-arrow").attr("viewBox","-5 -5 10 10").attr("refX","0").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");u.append("svg:marker").attr("id","edge-arrow").attr("viewBox","-5 -5 10 10").attr("refX","17").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");N=x.append("svg:path").style("marker-end","url(#drag-arrow)").attr("class","link").attr("d",r(0,0,0,0));N.classed("hidden",true);n=x.append("g").attr("id","edges");O=x.append("g").attr("id","nodes");x.on("dblclick",E);x.on("mousedown",M);x.on("mouseup",I);l=d.append("input").attr("type","hidden").attr("id","input_bias").attr("value","1").on("input",function(){W.bias=this.value;return P()});return P()};E=function(){var t,e;if(d3.event.defaultPrevented){return}t=d3.mouse(x.node());e=new Node(t[0],t[1]);s.push(e);return P()};M=function(){return t()};I=function(){if(A.shiftDrag){N.classed("hidden",true);return A.shiftDrag=false}};m=function(t){d3.event.stopPropagation();A.mouseDownNode=t;if(d3.event.shiftKey){A.shiftDrag=true;return N.classed("hidden",false).attr("d",r(t.x,t.y,t.x,t.y))}};k=function(t){var e,n,r;A.shiftDrag=false;r=A.mouseDownNode;if(!r){return}if(A.mouseDownNode!==t){e=new Edge(r,t);n=u.filter(function(t){if(t.start===e.finish&&t.finish===e.start){u.splice(u.indexOf(t))}return t.start===e.start&&t.finish===e.finish});if(n.length===0){if(v.indexOf(e.finish)!==-1){alert("You can't link to an input node");P();return}else if(w.indexOf(e.start)!==-1){alert("You can't link from an output node");P();return}r.outputs.push(e);t.inputs.push(e);t.inputWeights.push(1);u.push(e);if(i()){r.outputs.pop();t.inputs.pop();t.inputWeights.pop();u.pop();alert("Neural Networks Can't Be Cyclic!")}P()}}else{W=r;_()}return N.classed("hidden",true)};e=function(t){var e;console.log("Deleting node ",t.id);e=s.indexOf(t);console.log("Index of Node is ",e);if(e<0){return}u=u.filter(function(e){if(t.outputs.indexOf(e)<0&&t.inputs.indexOf(e)<0){return true}});s.splice(e,1);e=v.indexOf(t);if(e<0){v.splice(e,1)}e=w.indexOf(t);if(e<0){w.splice(e,1)}if(W===t){return W=null}};D=function(t){d3.event.preventDefault();e(t);return P()};L=function(){if(f.property("checked")){W.getAssociatedElement().classed("node-input",true);return v.push(W)}else{W.getAssociatedElement().classed("node-input",false);return v.slice(v.indexOf(W),1)}};B=function(){if(h.property("checked")){W.getAssociatedElement().classed("node-output",true);return w.push(W)}else{W.getAssociatedElement().classed("node-output",false);return v.slice(w.indexOf(W),1)}};C=function(){var t,e;e=O.selectAll("g").data(s,function(t){return t.id});t=e.enter().append("g").on("contextmenu",D).on("mousedown",m).on("mouseup",k).call(y);t.append("circle");t.append("text");e.select("text").text(function(t){return"Bias:"+t.bias}).attr("x",function(t){return t.x+"px"}).attr("y",function(t){return t.y+"px"}).attr("text-anchor","middle").attr("fill","#333");e.select("circle").attr("cx",function(t){return t.x+"px"}).attr("cy",function(t){return t.y+"px"}).attr("r","40").attr("class","node");e.attr("id",function(t){return"node_"+t.id});return e.exit().remove()};Y=function(){var t,e;t=n.selectAll("g").data(u,function(t){return t.start.id+"+"+t.finish.id});e=t.enter().append("g");e.append("path").style("marker-end","url(#edge-arrow)").classed("link",true);e.append("text").append("textPath").attr("xlink:href",function(t,e){return"#linkId_"+e});t.select("path").attr("id",function(t,e){return"linkId_"+e}).attr("d",function(t){return r(t.start.x,t.start.y,t.finish.x,t.finish.y)});t.select("text").attr("text-anchor","end").attr("dx",function(t){var e;e=Math.sqrt(Math.pow(t.start.x-t.finish.x,2)+Math.pow(t.start.y-t.finish.y,2));return e-100}).attr("dy","-10").attr("fill","#333");t.select("textPath").text(function(t){return"W:"+t.finish.inputWeights[t.finish.inputs.indexOf(t)]});t.attr("id",function(t){return"edge_"+t.id});return t.exit().remove()};t=function(){l.attr("type","hidden");b.inputWeights=[];b.bias=0;p.style("display","none");f.property("checked",false);c.style("display","none");h.property("checked",false);return H()};_=function(){b.inputWeights=W.inputWeights;b.bias=W.bias;l.attr("type","text");l.property("value",b.bias);if(W.inputs.length===0){p.style("display","table-row");f.property("checked",v.indexOf(W)!==-1)}else{p.style("display","none");f.property("checked",false)}if(W.outputs.length===0){c.style("display","table-row");h.property("checked",w.indexOf(W)!==-1)}else{c.style("display","none");h.property("checked",false)}return H()};H=function(){var t;t=g.selectAll("input").data(b.inputWeights);t.enter().append("input").attr("type","input").attr("value",function(t){return t}).attr("id",function(t,e){return"input_weight_"+e}).on("input",function(t,e){W.inputWeights[e]=this.value;return P()});return t.exit().remove()};P=function(){C();Y();return N.classed("hidden",true)};i=function(){var t,e,n,r,i,u,a,o,d;d=[];u=[];t=function(t){d[t]=false;return u[t]=false};for(n=r=0,a=s.length-1;0<=a?r<=a:r>=a;n=0<=a?++r:--r){t(n)}e=function(t){var n,r,i,a,o;if(d[t]===false){d[t]=true;u[t]=true;o=s[t].outputs;for(i=0,a=o.length;i<a;i++){n=o[i];r=s.indexOf(n.finish);if(!d[r]&&e(r)){return true}else if(u[r]){return true}}}u[t]=false;return false};for(n=i=0,o=s.length-1;0<=o?i<=o:i>=o;n=0<=o?++i:--i){if(e(n)){return true}}return false};return a};$(function(){var t;t=Network();return t("#neuron",[],[])});