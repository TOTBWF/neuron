var Edge,Network,Node;Node=function(){t.currentID=0;function t(e,n){this.x=e;this.y=n;this.id=t.currentID++;this.bias=0;this.inputWeights=[];this.inputs=[];this.outputs=[]}t.prototype.getAssociatedElement=function(){return d3.select("#node_"+this.id)};return t}();Edge=function(){function t(t,e){this.start_id=t;this.finish_id=e}return t}();Network=function(){var t,e,n,r,i,u,a,s,d,o,f,l,p,c,h,g,x,v,_,m,y,k,w,D,W,b,N,O,M,I,E,L,A,P,B,C,H,U,X;f=[];o=[];_=[];k=[];b={};L={mouseDownNode:null,shiftDrag:false};W=null;D=null;u=null;p=null;x=null;g=null;c=null;h=null;I=null;v=d3.behavior.drag().origin(function(t){return t}).on("drag",function(t){if(L.shiftDrag){return I.attr("d",a(t.x,t.y,d3.mouse(x.node())[0],d3.mouse(x.node())[1]))}else{t.x=d3.event.x;t.y=d3.event.y;d3.select(this).select("circle").attr("cx",t.x).attr("cy",t.y);d3.select(this).select("text").attr("x",t.x).attr("y",t.y);return C()}});l=function(t,n,r){var i;p=d3.select(t);c=d3.select("#neuron-panel-bias");g=d3.select("#neuron-panel-weights");d3.select("#compute-button").on("click",e);x=p.append("svg").attr("class","neuron-svg");i=x.append("svg:defs");i.append("svg:marker").attr("id","drag-arrow").attr("viewBox","-5 -5 10 10").attr("refX","0").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");i.append("svg:marker").attr("id","edge-arrow").attr("viewBox","-5 -5 10 10").attr("refX","17").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");I=x.append("svg:path").style("marker-end","url(#drag-arrow)").attr("class","link").attr("d",a(0,0,0,0));I.classed("hidden",true);u=x.append("g").attr("id","edges");D=x.append("g").attr("id","nodes");x.on("dblclick",A);x.on("mousedown",P);x.on("mouseup",B);h=c.append("input").attr("type","hidden").attr("id","input_bias").attr("value","1").on("input",function(){W.bias=this.value;return C()});return C()};N=function(t){var e,n;n=s(t.start_id);e=s(t.finish_id);O(n);M(e);i(_,e);return i(k,n)};O=function(t){if(t.inputs.length===0&&_.indexOf(t)===-1){return _.push(t)}};M=function(t){if(t.outputs.length===0&&k.indexOf(t)===-1){return k.push(t)}};a=function(t,e,n,r){return"M "+t+" "+e+" L "+n+" "+r};s=function(t){var e,n,r;for(e=n=0,r=f.length-1;0<=r?n<=r:n>=r;e=0<=r?++n:--n){if(f[e].id===t){return f[e]}}return-1};i=function(t,e){var n;n=t.indexOf(e);if(n!==-1){t.splice(n,1);return true}else{return false}};A=function(){var t,e;if(d3.event.defaultPrevented){return}t=d3.mouse(x.node());e=new Node(t[0],t[1]);f.push(e);return C()};P=function(){return t()};B=function(){if(L.shiftDrag){I.classed("hidden",true);return L.shiftDrag=false}};m=function(t){d3.event.stopPropagation();L.mouseDownNode=t;if(d3.event.shiftKey){L.shiftDrag=true;return I.classed("hidden",false).attr("d",a(t.x,t.y,t.x,t.y))}};y=function(t){var e,n,r;L.shiftDrag=false;r=L.mouseDownNode;if(!r){return}if(L.mouseDownNode!==t){e=new Edge(r.id,t.id);n=o.filter(function(t){if(t.start_id===e.finish_id&&t.finish_id===e.start_id){o.splice(o.indexOf(t),1)}return t.start_id===e.start_id&&t.finish_id===e.finish_id});if(n.length===0){r.outputs.push(e);t.inputs.push(e);t.inputWeights.push(1);o.push(e);if(d()){r.outputs.pop();t.inputs.pop();t.inputWeights.pop();o.pop();alert("Neural Networks Can't Be Cyclic!")}else{N(e)}C()}}else{W=r;E()}return I.classed("hidden",true)};r=function(t){console.log("Deleting node ",t.id);o=o.filter(function(e){var n,r;if(t.outputs.indexOf(e)!==-1){n=s(e.finish_id);n.inputs.splice(n.inputs.indexOf(e));O(n);return false}else if(t.inputs.indexOf(e)!==-1){r=s(e.start_id);r.outputs.splice(r.outputs.indexOf(e));M(r);return false}else{return true}});i(f,t);i(_,t);i(k,t);if(W===t){return W=null}};w=function(t){d3.event.preventDefault();r(t);return C()};U=function(){var t,e;e=D.selectAll("g").data(f,function(t){return t.id});t=e.enter().append("g").on("contextmenu",w).on("mousedown",m).on("mouseup",y).call(v);t.append("circle");t.append("text");e.select("text").text(function(t){return"ID: "+t.id}).attr("x",function(t){return t.x+"px"}).attr("y",function(t){return t.y+"px"}).attr("text-anchor","middle").attr("fill","#333");e.select("circle").attr("cx",function(t){return t.x+"px"}).attr("cy",function(t){return t.y+"px"}).attr("r","40").attr("class","node");e.attr("id",function(t){return"node_"+t.id}).classed("node-input",function(t){return _.indexOf(t)!==-1}).classed("node-output",function(t){return k.indexOf(t)!==-1});return e.exit().remove()};H=function(){var t,e;t=u.selectAll("g").data(o,function(t){return t.start_id+"+"+t.finish_id});e=t.enter().append("g");e.append("path").style("marker-end","url(#edge-arrow)").classed("link",true);e.append("text").append("textPath").attr("xlink:href",function(t,e){return"#linkId_"+e});t.select("path").attr("id",function(t,e){return"linkId_"+e}).attr("d",function(t){var e,n;n=s(t.start_id);e=s(t.finish_id);return a(n.x,n.y,e.x,e.y)});t.select("text").attr("text-anchor","end").attr("dx",function(t){var e,n,r;r=s(t.start_id);n=s(t.finish_id);e=Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2));return e-100}).attr("dy","-10").attr("fill","#333");t.select("textPath").text(function(t){var e;e=s(t.finish_id);return""+e.inputs.indexOf(t)});t.attr("id",function(t){return"edge_"+t.start_id+"-"+t.finish_id});return t.exit().remove()};t=function(){h.attr("type","hidden");b.inputWeights=[];b.bias=0;return X()};E=function(){b.inputWeights=W.inputWeights;b.bias=W.bias;h.attr("type","text");h.property("value",b.bias);return X()};X=function(){var t;t=g.selectAll("input").data(b.inputWeights);t.enter().append("input").attr("type","input").attr("value",function(t){return t}).attr("id",function(t,e){return"input_weight_"+e}).on("input",function(t,e){W.inputWeights[e]=this.value;return C()});return t.exit().remove()};C=function(){U();H();return I.classed("hidden",true)};d=function(){var t,e,n,r,i,u,a,s,d;d=[];u=[];t=function(t){d[t]=false;return u[t]=false};for(n=r=0,a=f.length-1;0<=a?r<=a:r>=a;n=0<=a?++r:--r){t(n)}e=function(t){var n,r,i,a,s;if(d[t]===false){d[t]=true;u[t]=true;s=f[t].outputs;for(i=0,a=s.length;i<a;i++){n=s[i];r=f.indexOf(n.finish);if(!d[r]&&e(r)){return true}else if(u[r]){return true}}}u[t]=false;return false};for(n=i=0,s=f.length-1;0<=s?i<=s:i>=s;n=0<=s?++i:--i){if(e(n)){return true}}return false};n=function(t,e){var n,r,i,u;if(t.length!==e.inputWeights.length){console.error("Input and Input Weight length mismatch on node_",e.id);return}u=0;for(n=r=0,i=t.length-1;0<=i?r<=i:r>=i;n=0<=i?++r:--r){u+=t[n]*e.inputWeights[n]}return 1/(1+Math.pow(Math.E,u-e.bias))};e=function(){var t,e,r,i,u;u=function(t){var e,r,i,a,d,o;if(t.inputs.length===0){return t.bias}i=[];o=t.inputs;r=function(t){return i.push(u(s(t.start_id)))};for(a=0,d=o.length;a<d;a++){e=o[a];r(e)}return n(i,t)};i="";for(t=0,e=k.length;t<e;t++){r=k[t];i+="node_"+r.id+" = "+u(r)+"\n"}alert(i);return C()};return l};$(function(){var t;t=Network();return t("#neuron",[],[])});