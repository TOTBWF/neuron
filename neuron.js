var Network;Network=function(){var t,e,n,r,i,a,u,s,o,d,l,f,p,c,h,g,x,v,m,y,k,w,W,b,D,N,M,L;a=[];i=[];m={};k={mouseDownNode:null,shiftDrag:false};v=null;t=0;x=null;e=null;s=null;f=null;l=null;o=null;d=null;y=null;n=function(t,e,n,r){return"M "+t+" "+e+" L "+n+" "+r};p=d3.behavior.drag().origin(function(t){return t}).on("drag",function(t){if(k.shiftDrag){return y.attr("d",n(t.x,t.y,d3.mouse(f.node())[0],d3.mouse(f.node())[1]))}else{t.x=d3.event.x;t.y=d3.event.y;d3.select(this).select("circle").attr("cx",t.x).attr("cy",t.y);d3.select(this).select("text").attr("x",t.x).attr("y",t.y);return D()}});u=function(t,r,i){var a;s=d3.select(t);o=d3.select("#neuron-panel-bias");l=d3.select("#neuron-panel-weights");f=s.append("svg").attr("class","neuron-svg");a=f.append("svg:defs");a.append("svg:marker").attr("id","drag-arrow").attr("viewBox","-5 -5 10 10").attr("refX","0").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");a.append("svg:marker").attr("id","edge-arrow").attr("viewBox","-5 -5 10 10").attr("refX","17").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");y=f.append("svg:path").style("marker-end","url(#drag-arrow)").attr("class","link").attr("d",n(0,0,0,0));y.classed("hidden",true);e=f.append("g").attr("id","edges");x=f.append("g").attr("id","nodes");f.on("dblclick",w);f.on("mousedown",W);f.on("mouseup",b);d=o.append("input").attr("type","hidden").attr("id","input_bias").attr("value","1").on("input",function(){v.bias=this.value;return D()});return D()};w=function(){var e,n;if(d3.event.defaultPrevented){return}e=d3.mouse(f.node());n={id:t++,x:e[0],y:e[1],bias:0,inputWeights:[],inputs:[],outputs:[]};a.push(n);return D()};W=function(){};b=function(){if(k.shiftDrag){y.classed("hidden",true);return k.shiftDrag=false}};c=function(t){d3.event.stopPropagation();k.mouseDownNode=t;if(d3.event.shiftKey){k.shiftDrag=true;return y.classed("hidden",false).attr("d",n(t.x,t.y,t.x,t.y))}};h=function(t){var e,n,a;k.shiftDrag=false;a=k.mouseDownNode;if(!a){return}if(k.mouseDownNode!==t){e={start:a,finish:t};n=i.filter(function(t){if(t.start===e.finish&&t.finish===e.start){i.splice(i.indexOf(t))}return t.start===e.start&&t.finish===e.finish});if(n.length===0){a.outputs.push(e);t.inputs.push(e);t.inputWeights.push(1);i.push(e);if(r()){a.outputs.pop();t.inputs.pop();t.inputWeights.pop();i.pop();alert("Neural Networks Can't Be Cyclic!")}D()}}else{v=a;m.inputWeights=a.inputWeights;m.bias=a.bias;d.attr("type","text");d.attr("value",m.bias);L()}return y.classed("hidden",true)};g=function(t){var e;d3.event.preventDefault();e=0;while(e<a.length){if(a[e].id===t.id){i=i.filter(function(t){var n;n=a[e];if(n.outputs.indexOf(t)<0&&n.inputs.indexOf(t)<0){return true}});a.splice(e,1);break}else{e+=1}}return D()};M=function(){var t,e;e=x.selectAll("g").data(a,function(t){return t.id});t=e.enter().append("g").on("contextmenu",g).on("mousedown",c).on("mouseup",h).call(p);t.append("circle");t.append("text");e.select("text").text(function(t){return"Bias:"+t.bias}).attr("x",function(t){return t.x+"px"}).attr("y",function(t){return t.y+"px"}).attr("text-anchor","middle").attr("fill","#333");e.select("circle").attr("cx",function(t){return t.x+"px"}).attr("cy",function(t){return t.y+"px"}).attr("r","40").attr("class","node");e.attr("id",function(t){return t.id});return e.exit().remove()};N=function(){var t,r;t=e.selectAll("g").data(i,function(t){return t.start.id+"+"+t.finish.id});r=t.enter().append("g");r.append("path").style("marker-end","url(#edge-arrow)").classed("link",true);r.append("text").append("textPath").attr("xlink:href",function(t,e){return"#linkId_"+e});t.select("path").attr("id",function(t,e){return"linkId_"+e}).attr("d",function(t){return n(t.start.x,t.start.y,t.finish.x,t.finish.y)});t.select("text").attr("text-anchor","end").attr("dx",function(t){var e;e=Math.sqrt(Math.pow(t.start.x-t.finish.x,2)+Math.pow(t.start.y-t.finish.y,2));return e-100}).attr("dy","-10").attr("fill","#333");t.select("textPath").text(function(t){return"W:"+t.finish.inputWeights[t.finish.inputs.indexOf(t)]});return t.exit().remove()};L=function(){var t;t=l.selectAll("input").data(m.inputWeights);t.enter().append("input").attr("type","input").attr("value",function(t){return t}).attr("id",function(t,e){return"input_weight_"+e}).on("input",function(t,e){console.log(t);v.inputWeights[e]=this.value;return D()});return t.exit().remove()};D=function(){M();return N()};r=function(){var t,e,n,r,i,u,s,o,d;d=[];u=[];t=function(t){d[t]=false;return u[t]=false};for(n=r=0,s=a.length-1;0<=s?r<=s:r>=s;n=0<=s?++r:--r){t(n)}e=function(t){var n,r,i,s,o;if(d[t]===false){d[t]=true;u[t]=true;o=a[t].outputs;for(i=0,s=o.length;i<s;i++){n=o[i];r=a.indexOf(n.finish);if(!d[r]&&e(r)){return true}else if(u[r]){return true}}}u[t]=false;return false};for(n=i=0,o=a.length-1;0<=o?i<=o:i>=o;n=0<=o?++i:--i){if(e(n)){return true}}return false};return u};$(function(){var t;t=Network();return t("#neuron",[],[])});