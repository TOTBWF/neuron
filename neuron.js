var Edge,Network,Node;Node=function(){t.currentID=0;function t(e,n){this.x=e;this.y=n;this.id=t.currentID++;this.bias=0;this.inputWeights=[];this.inputs=[];this.outputs=[]}t.prototype.getAssociatedElement=function(){return d3.select("#node_"+this.id)};return t}();Edge=function(){function t(t,e){this.start_id=t;this.finish_id=e}return t}();Network=function(){var t,e,n,r,i,u,a,s,o,d,f,l,p,c,h,g,x,v,_,m,y,k,w,W,b,D,N,O,M,I,E,L,A,B,P,C,H;f=[];d=[];_=[];k=[];D={};I={mouseDownNode:null,shiftDrag:false};b=null;W=null;u=null;p=null;x=null;g=null;c=null;h=null;O=null;v=d3.behavior.drag().origin(function(t){return t}).on("drag",function(t){if(I.shiftDrag){return O.attr("d",a(t.x,t.y,d3.mouse(x.node())[0],d3.mouse(x.node())[1]))}else{t.x=d3.event.x;t.y=d3.event.y;d3.select(this).select("circle").attr("cx",t.x).attr("cy",t.y);d3.select(this).select("text").attr("x",t.x).attr("y",t.y);return B()}});l=function(t,n,r){var i;p=d3.select(t);c=d3.select("#neuron-panel-bias");g=d3.select("#neuron-panel-weights");d3.select("#compute-button").on("click",e);x=p.append("svg").attr("class","neuron-svg");i=x.append("svg:defs");i.append("svg:marker").attr("id","drag-arrow").attr("viewBox","-5 -5 10 10").attr("refX","0").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");i.append("svg:marker").attr("id","edge-arrow").attr("viewBox","-5 -5 10 10").attr("refX","17").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");O=x.append("svg:path").style("marker-end","url(#drag-arrow)").attr("class","link").attr("d",a(0,0,0,0));O.classed("hidden",true);u=x.append("g").attr("id","edges");W=x.append("g").attr("id","nodes");x.on("dblclick",E);x.on("mousedown",L);x.on("mouseup",A);h=c.append("input").attr("type","hidden").attr("id","input_bias").attr("value","1").on("input",function(){b.bias=this.value;return B()});return B()};N=function(t){var e,n;n=s(t.start_id);e=s(t.finish_id);if(n.inputs.length===0&&_.indexOf(n)===-1){_.push(n)}if(e.outputs.length===0&&k.indexOf(e)===-1){k.push(e)}if(i(_,e)){console.log("node_"+e.id+" is no longer an input node")}if(i(k,n)){return console.log("node_"+n.id+" is no longer an output node")}};a=function(t,e,n,r){return"M "+t+" "+e+" L "+n+" "+r};s=function(t){var e,n,r;for(e=n=0,r=f.length;0<=r?n<=r:n>=r;e=0<=r?++n:--n){if(f[e].id===t){return f[e]}}};i=function(t,e){var n;n=t.indexOf(e);if(n!==-1){t.splice(n,1);return true}else{return false}};E=function(){var t,e;if(d3.event.defaultPrevented){return}t=d3.mouse(x.node());e=new Node(t[0],t[1]);f.push(e);return B()};L=function(){return t()};A=function(){if(I.shiftDrag){O.classed("hidden",true);return I.shiftDrag=false}};m=function(t){d3.event.stopPropagation();I.mouseDownNode=t;if(d3.event.shiftKey){I.shiftDrag=true;return O.classed("hidden",false).attr("d",a(t.x,t.y,t.x,t.y))}};y=function(t){var e,n,r;I.shiftDrag=false;r=I.mouseDownNode;if(!r){return}if(I.mouseDownNode!==t){e=new Edge(r.id,t.id);n=d.filter(function(t){if(t.start_id===e.finish_id&&t.finish_id===e.start_id){d.splice(d.indexOf(t),1)}return t.start_id===e.start_id&&t.finish_id===e.finish_id});if(n.length===0){r.outputs.push(e);t.inputs.push(e);t.inputWeights.push(1);d.push(e);if(o()){r.outputs.pop();t.inputs.pop();t.inputWeights.pop();d.pop();alert("Neural Networks Can't Be Cyclic!")}else{N(e)}B()}}else{b=r;M()}return O.classed("hidden",true)};r=function(t){console.log("Deleting node ",t.id);i(f,t);i(_,t);i(k,t);d=d.filter(function(e){if(t.outputs.indexOf(e)<0&&t.inputs.indexOf(e)<0){return true}});if(b===t){return b=null}};w=function(t){d3.event.preventDefault();r(t);return B()};C=function(){var t,e;e=W.selectAll("g").data(f,function(t){return t.id});t=e.enter().append("g").on("contextmenu",w).on("mousedown",m).on("mouseup",y).call(v);t.append("circle");t.append("text");e.select("text").text(function(t){if(_.indexOf(t)!==-1){return"Input:"+t.bias}else{return"Bias:"+t.bias}}).attr("x",function(t){return t.x+"px"}).attr("y",function(t){return t.y+"px"}).attr("text-anchor","middle").attr("fill","#333");e.select("circle").attr("cx",function(t){return t.x+"px"}).attr("cy",function(t){return t.y+"px"}).attr("r","40").attr("class","node");e.attr("id",function(t){return"node_"+t.id}).classed("node-input",function(t){return _.indexOf(t)!==-1}).classed("node-output",function(t){return k.indexOf(t)!==-1});return e.exit().remove()};P=function(){var t,e;t=u.selectAll("g").data(d,function(t){return t.start_id+"+"+t.finish_id});e=t.enter().append("g");e.append("path").style("marker-end","url(#edge-arrow)").classed("link",true);e.append("text").append("textPath").attr("xlink:href",function(t,e){return"#linkId_"+e});t.select("path").attr("id",function(t,e){return"linkId_"+e}).attr("d",function(t){var e,n;n=s(t.start_id);e=s(t.finish_id);return a(n.x,n.y,e.x,e.y)});t.select("text").attr("text-anchor","end").attr("dx",function(t){var e,n,r;r=s(t.start_id);n=s(t.finish_id);e=Math.sqrt(Math.pow(r.x-n.x,2)+Math.pow(r.y-n.y,2));return e-100}).attr("dy","-10").attr("fill","#333");t.select("textPath").text(function(t){var e;e=s(t.finish_id);return"W:"+e.inputWeights[e.inputs.indexOf(t)]});t.attr("id",function(t){return"edge_"+t.start_id+"-"+t.finish_id});return t.exit().remove()};t=function(){h.attr("type","hidden");D.inputWeights=[];D.bias=0;return H()};M=function(){D.inputWeights=b.inputWeights;D.bias=b.bias;h.attr("type","text");h.property("value",D.bias);return H()};H=function(){var t;t=g.selectAll("input").data(D.inputWeights);t.enter().append("input").attr("type","input").attr("value",function(t){return t}).attr("id",function(t,e){return"input_weight_"+e}).on("input",function(t,e){b.inputWeights[e]=this.value;return B()});return t.exit().remove()};B=function(){C();P();return O.classed("hidden",true)};o=function(){var t,e,n,r,i,u,a,s,o;o=[];u=[];t=function(t){o[t]=false;return u[t]=false};for(n=r=0,a=f.length-1;0<=a?r<=a:r>=a;n=0<=a?++r:--r){t(n)}e=function(t){var n,r,i,a,s;if(o[t]===false){o[t]=true;u[t]=true;s=f[t].outputs;for(i=0,a=s.length;i<a;i++){n=s[i];r=f.indexOf(n.finish);if(!o[r]&&e(r)){return true}else if(u[r]){return true}}}u[t]=false;return false};for(n=i=0,s=f.length-1;0<=s?i<=s:i>=s;n=0<=s?++i:--i){if(e(n)){return true}}return false};n=function(t,e){var n,r,i,u;if(t.length!==e.inputWeights.length){console.error("Input and Input Weight length mismatch on node_",e.id);return}u=0;for(n=r=0,i=t.length-1;0<=i?r<=i:r>=i;n=0<=i?++r:--r){u+=t[n]*e.inputWeights[n]}return 1/(1+Math.pow(Math.E,u-e.bias))};e=function(){var t,e,r,i,u;i=function(t){var e,r,u,a,o,d;if(t.inputs.length===0){return t.bias}u=[];d=t.inputs;r=function(t){return u.push(i(s(t.start_id)))};for(a=0,o=d.length;a<o;a++){e=d[a];r(e)}return n(u,t)};u=[];for(t=0,e=k.length;t<e;t++){r=k[t];console.log("node_"+r.id+" = "+i(r));u.push(B())}return u};return l};$(function(){var t;t=Network();return t("#neuron",[],[])});