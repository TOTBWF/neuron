var Network;Network=function(){var t,e,r,n,a,i,u,s,d,o,f,l,c,p,h,g,v,x,m,k,w,y;i=[];a=[];g={mouseDownNode:null,shiftDrag:false};t=0;p=null;e=null;s=null;d=null;h=null;r=function(t,e,r,n){return"M "+t+" "+e+" L "+r+" "+n};o=d3.behavior.drag().origin(function(t){return t}).on("drag",function(t){if(g.shiftDrag){return h.attr("d",r(t.x,t.y,d3.mouse(d.node())[0],d3.mouse(d.node())[1]))}else{t.x=d3.event.x;t.y=d3.event.y;d3.select(this).select("circle").attr("cx",t.x).attr("cy",t.y);d3.select(this).select("text").attr("x",t.x).attr("y",t.y);return k()}});u=function(t,n,a){var i;s=d3.select(t);d=s.append("svg").attr("width","100%").attr("height","100%");i=d.append("svg:defs");i.append("svg:marker").attr("id","drag-arrow").attr("viewBox","-5 -5 10 10").attr("refX","0").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");i.append("svg:marker").attr("id","edge-arrow").attr("viewBox","-5 -5 10 10").attr("refX","17").attr("refY","0").attr("markerWidth","5").attr("markerHeight","5").attr("markerUnits","strokeWidth").attr("orient","auto").append("svg:path").attr("d","M0 0 m -5 -5 L 5 0 L -5 5 Z");h=d.append("svg:path").style("marker-end","url(#drag-arrow)").attr("class","link").attr("d",r(0,0,0,0));h.classed("hidden",true);e=d.append("g").attr("id","edges");p=d.append("g").attr("id","nodes");d.on("dblclick",v);d.on("mousedown",x);d.on("mouseup",m);return k()};v=function(){var e,r;if(d3.event.defaultPrevented){return}e=d3.mouse(d.node());r={id:t++,x:e[0],y:e[1],edges:[]};i.push(r);return k()};x=function(){};m=function(){if(g.shiftDrag){h.classed("hidden",true);return g.shiftDrag=false}};f=function(t){d3.event.stopPropagation();g.mouseDownNode=t;if(d3.event.shiftKey){g.shiftDrag=true;return h.classed("hidden",false).attr("d",r(t.x,t.y,t.x,t.y))}};l=function(t){var e,r,i;g.shiftDrag=false;i=g.mouseDownNode;if(!i){return}if(g.mouseDownNode!==t){e={start:i,finish:t};r=a.filter(function(t){if(t.start===e.finish&&t.finish===e.start){a.splice(a.indexOf(t))}return t.start===e.start&&t.finish===e.finish});if(r.length===0){i.edges.push(e);a.push(e);if(n()){i.edges.pop();a.pop();alert("Neural Networks Can't Be Cyclic!")}k()}}return h.classed("hidden",true)};c=function(t){var e;d3.event.preventDefault();e=0;while(e<i.length){if(i[e].id===t.id){i.splice(e,1);break}else{e+=1}}return k()};y=function(){var t,e;e=p.selectAll("g").data(i,function(t){return t.id});t=e.enter().append("g").on("contextmenu",c).on("mousedown",f).on("mouseup",l).call(o);t.append("circle");t.append("text");e.select("text").text(function(t){return t.id}).attr("x",function(t){return t.x+"px"}).attr("y",function(t){return t.y+"px"}).attr("fill","black");e.select("circle").attr("cx",function(t){return t.x+"px"}).attr("cy",function(t){return t.y+"px"}).attr("r","40").attr("fill","white").attr("stroke","black").attr("stroke-width","3");e.attr("id",function(t){return t.id});return e.exit().remove()};w=function(){var t;t=e.selectAll("path").data(a,function(t){return t.start.id+"+"+t.finish.id});t.enter().append("path").style("marker-end","url(#edge-arrow)").classed("link",true);t.attr("d",function(t){return r(t.start.x,t.start.y,t.finish.x,t.finish.y)});return t.exit().remove()};k=function(){y();return w()};n=function(){var t,e,r,n,a,u,s,d,o;o=[];u=[];t=function(t){o[t]=false;return u[t]=false};for(r=n=0,s=i.length-1;0<=s?n<=s:n>=s;r=0<=s?++n:--n){t(r)}e=function(t){var r,n,a,s,d;if(o[t]===false){o[t]=true;u[t]=true;d=i[t].edges;for(a=0,s=d.length;a<s;a++){r=d[a];n=i.indexOf(r.finish);if(!o[n]&&e(n)){return true}else if(u[n]){return true}}}u[t]=false;return false};for(r=a=0,d=i.length-1;0<=d?a<=d:a>=d;r=0<=d?++a:--a){if(e(r)){return true}}return false};return u};$(function(){var t;t=Network();return t("#neuron",[],[])});